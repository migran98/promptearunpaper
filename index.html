<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promptear un paper</title>
    <!-- Fuente personalizada -->
    <style>

    </style>
    <link rel="stylesheet" href="public/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Resto del contenido de la p√°gina -->
    <img id="title" src="public/img/titulo_web.png" alt="Promptear un Paper">

    <div class="cajaprincipal">
        
        <!--<h1 id="titulo">Des-promptear un paper. Pr√°cticas art√≠sticas para la desarticulaci√≥n de la inmediatez iconotextual de la IA</h1>-->
        <p id="resumen"><strong>Resumen:</strong> Prompt, es en ingl√©s inmediato y solicitud al mismo tiempo. Esta etimolog√≠a polis√©mica que  ahora es tambi√©n ‚Äî para el resto de realidades no angl√≥fonas ‚Äî ese fragmento textual a trav√©s del que interactuamos con sistemas de inteligencia artificial; deviene el reflejo sem√°ntico de los procesos de aceleraci√≥n sociot√©cnica que acostumbra a utilizar el sistema tecnocapitalista para cumplir con su paradigma de crecimiento exponencial. Estas tendencias aceleracionistas que procuran conceder lo deseado en el menor tiempo posible en nombre de la m√°xima eficiencia, nos han conducido a lo que algunos autores han denominado sociedades del sofoco y la fatiga (Espluga, 2021), repercutiendo asimismo en la producci√≥n textual e iconogr√°fica de los √∫ltimos dos a√±os, trav√©s de la implementaci√≥n de la ingenier√≠a de la demanda o prompt engineering.</p>
        <textarea id="inputText" placeholder="Escribe aqu√≠ tu prompt..."></textarea>
        <button onclick="submitText()">Enviar prompt</button>
        <button onclick="generateStyledPDF()">¬°Descarga el paper!</button>
        <!-- <div class="referencias">
            <p>Espluga, E. (2021). <em>No seas t√∫ mismo...</em></p>
            <p>Hartmut, R. (2016). <em>Alienaci√≥n Y Aceleraci√≥n...</em></p>
        </div>-->
         <!-- Chatbot response section -->
         <div class="chatbot-response">
            <p id="t√≠tulo"><strong>Irene S√°nchez Mora // Miguel Rangil Gallardo</strong></p>
            <div class="typewriter-container">
                <div id="chatbotResponse" class="typewriter"></div>
            </div>
        </div>
    </div>


    <script>
        const sectionPrompts = {
            "Introduccion-Parte-1": [
            /qui√©n sabe/i,
            /no estoy seguro/i,
            /quiz√° m√°s tarde/i,
            /lo pensar√©/i,
            /tal vez despu√©s/i,
            /qui√©n sabr√°/i,
            /me da pereza pensar en eso ahora/i,
            /uff, ni idea/i,
            /ü§∑‚Äç‚ôÇÔ∏è/i,
            /üôÑ/i
            ],
            "Introduccion-Parte-2": [
            /no me acuerdo/i,
            /me olvid√©/i,
            /dejame recordar/i,
            /mmm... tal vez/i,
            /esto es complicado/i,
            /no es tan simple/i,
            /no lo s√©/i,
            /puede ser, qui√©n sabe/i,
            /mi mente est√° en blanco/i,
            /üåÄ/i
            ],
            "Introduccion-Parte-3": [
            /d√©jame adivinar/i,
            /mejor no digo nada/i,
            /estoy confundido/i,
            /qu√© era eso otra vez/i,
            /creo que s√≠, pero no estoy seguro/i,
            /ü§î/i,
            /si te soy sincero, no s√©/i,
            /esa es buena pregunta/i,
            /paso/i,
            /ü§∑‚Äç‚ôÄÔ∏è/i
            ],
            "Metodologia-Parte-1": [/michis gricis mi gistirii sigir liyindi/i, 
            /muchus grucus mu gusturuu sugur luyundu/i, /machas gracas ma gastaraa sagar layanda/i,
            /meches greces me gesteree seger leyende/i,/mochos grocos mo gostoroo sogor loyondo/i,],
            "Metodologia-Parte-2": [
                /dimi mus tixto/i,
                /doma mis texlo/i,
                /dumi mus toxte/i,
                /dami mes tuxto/i,
                /dime mis tuxte/i
            ],

            "Metodologia-Parte-3": [
                /ginira il tixto/i,
                /genuri ul texlu/i,
                /gunara el taxte/i,
                /ganira il tuxte/i,
                /ginira ul toxte/i
            ],

            "Resultados-Parte-1": [
                /üåµ/i, /üåº/i, /ü´Ä/i, /üêù/i, /ü¶ã/i, /ü™≤/i, /ü©∂/i, /ü´ê/i, /üêæ/i,
                /ü•Ä/i, /üçÇ/i, /üåô/i, /üé®/i, /üõ∏/i, /üêö/i, /‚ú®/i, /üåÄ/i, /üîÆ/i,
                /üåà/i, /üå∏/i, /üêâ/i, /ü¶Ñ/i, /üñ§/i, /üíå/i, /üç≠/i, /ü¶ä/i, /üí´/i
            ],
            "Resultados-Parte-2": [
                /üßø/i, /ü¶ï/i, /ü¶©/i, /ü¶¢/i, /ü¶ö/i, /üçÑ/i, /üí≠/i, /üå†/i, /üçØ/i,
                /ü¶•/i, /üåø/i, /üåπ/i, /ü••/i, /ü´ñ/i, /üßµ/i, /‚öõÔ∏è/i, /üßÉ/i, /üéã/i,
                /üõÅ/i, /üç∞/i, /üïØÔ∏è/i, /üóùÔ∏è/i, /üß∏/i, /üéÅ/i, /üîã/i, /üõ§Ô∏è/i, /üöÄ/i
            ],
            "Resultados-Parte-3": [
                /üñãÔ∏è/i, /üåä/i, /üíº/i, /üçµ/i, /üéπ/i, /ü™ï/i, /üß¨/i, /üõ†Ô∏è/i, /üéûÔ∏è/i,
                /üßò‚Äç‚ôÇÔ∏è/i, /ü¶ú/i, /ü™û/i, /üé≠/i, /üõ°Ô∏è/i, /üîî/i, /üßØ/i, /üåê/i, /üîç/i,
                /üìú/i, /üßÖ/i, /üç∑/i, /üóø/i, /üîß/i, /üì°/i, /üíø/i, /üì∏/i, /üß†/i
            ],
            "Conclusiones-Parte-1": [/Qu√© interesante, muchos besos a tus padres/i, /Qu√© bien escribes, un abrazo de parte de la abuela/i],
            "Conclusiones-Parte-2": [/Qu√© bien redactado, la t√≠a te manda recuerdos/i, /Qu√© bien redactado, la t√≠a te manda recuerdos/i],
            "Conclusiones-Parte-3": [/Guape, tus amigues te mandan recuerdos/i]
        };

        const paperContent = {
            "Introduccion-Parte-1": "",
            "Introduccion-Parte-2": "",
            "Introduccion-Parte-3": "",
            "Metodologia-Parte-1": "",
            "Metodologia-Parte-2": "",
            "Metodologia-Parte-3": "",
            "Resultados-Parte-1": "",
            "Resultados-Parte-2": "",
            "Resultados-Parte-3": "",
            "Conclusiones-Parte-1": "",
            "Conclusiones-Parte-2": "",
            "Conclusiones-Parte-3": ""
        };

        let completedSections = new Set();
        let boolCompleted = [false,false,false,false,false,false,false,false,false,false,false,false]

        function checkSectionCompletion(prompt) {
            let cont = 0
            for (let section in sectionPrompts) {
                if (!completedSections.has(section) && sectionPrompts[section].some(pattern => pattern.test(prompt))) {
                    completedSections.add(section);
                    markSectionAsCompleted(section);
                    boolCompleted[cont] = true
                    return section;
                }
                cont++
            }
            return null;
        }

        function markSectionAsCompleted(section) {
            const sectionId = section.toLowerCase() + "-item";
            const sectionItem = document.getElementById(sectionId);
            if (sectionItem) {
                sectionItem.style.textDecoration = "line-through";
                alert(`¬°Has completado la secci√≥n: ${section}! Puedes descargar el PDF correspondiente.`);
            } else {
                console.error("No se pudo encontrar el elemento con id:", sectionId);
            }
        }

        async function submitText() {
            const inputText = document.getElementById("inputText").value;
            const completedSection = checkSectionCompletion(inputText);

            const newPrompt = inputText + " || ARRAY: " + JSON.stringify(boolCompleted)

            console.log(`Fetching content for prompt: ${inputText}`);
            try {
                //const response = await fetch(`/generate-paper?sections=${completedSection || ""}&prompt=${encodeURIComponent(inputText)}`);
                const response = await fetch(`/generate-paper?sections=${completedSection || ""}&prompt=${encodeURIComponent(newPrompt)}`);
                console.log("Response received from API:", response);

                if (!response.ok) {
                    throw new Error(`Error en la respuesta de la API: ${response.status}`);
                }

                const data = await response.json();
                console.log("Parsed JSON data:", data);

                // Update the paper content if available
                if (completedSection && data && data.paper && typeof data.paper[completedSection] === 'string' && data.paper[completedSection].trim() !== "") {
                    paperContent[completedSection] = data.paper[completedSection];
                    console.log(`Contenido actualizado para la secci√≥n ${completedSection}:`, paperContent[completedSection]);
                    alert(`Se ha completado la secci√≥n: ${completedSection}. Puedes descargar el PDF actualizado.`);
                } else {
                    console.warn(`No se recibi√≥ contenido v√°lido para la secci√≥n: ${completedSection}`);
                    paperContent[completedSection] = "[Contenido no disponible]";
                }

                // Update the chatbot response if available
                if (data && typeof data.chatbotResponse === 'string') {
                    typeWriter(data.chatbotResponse);
                } else {
                    typeWriter("[Respuesta no disponible]");
                }

            } catch (error) {
                console.error("Error al obtener la variaci√≥n de la secci√≥n:", error);
                alert("Hubo un problema al generar la variaci√≥n.");
            } finally {
                document.getElementById("inputText").value = "";
            }
        }

        function typeWriter(text) {
            const chatbotResponseElement = document.getElementById("chatbotResponse");
            chatbotResponseElement.innerHTML = "";
            let i = 0;

            function typeChar() {
                if (i < text.length) {
                    if (text.charAt(i) === '\n') {
                        chatbotResponseElement.classList.add('fade-out');
                    }
                    chatbotResponseElement.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(typeChar, 50);
                } else {
                    chatbotResponseElement.classList.add('fade-out');
                }
            }

            chatbotResponseElement.classList.remove('fade-out');
            typeChar();
        }

        function generateStyledPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF("p", "pt", "a4");

            try {
                const marginLeft = 40;
                const maxWidth = 515; // Adjusted for better margin handling
                const pageHeight = 820; // Approximate height for content on A4
                let yPos = 40;

                doc.setFont("times", "normal");
                doc.setFontSize(18);
                doc.text("Promptear un paper.", marginLeft, yPos);
                yPos += 30;

                doc.setFontSize(12);
                doc.text("Autores: S√°nchez Mora, Irene / Rangil Gallardo, Miguel", marginLeft, yPos);
                yPos += 15;
                doc.text("Laboratorio de Luz. Universidad Polit√©cnica de Val√®ncia", marginLeft, yPos);
                yPos += 25;

                doc.setLineWidth(0.5);
                doc.line(marginLeft, yPos, marginLeft + maxWidth, yPos);
                yPos += 30;

                doc.setFontSize(14);
                doc.setFont("times", "italic");
                doc.text("Resumen", marginLeft, yPos);
                yPos += 20;

                doc.setFont("times", "normal");
                doc.setFontSize(11);
                const resumen = "Prompt, es en ingl√©s inmediato y solicitud al mismo tiempo. Esta etimolog√≠a polis√©mica que  ahora es tambi√©n ‚Äî para el resto de realidades no angl√≥fonas ‚Äî ese fragmento textual a trav√©s del que interactuamos con sistemas de inteligencia artificial; deviene el reflejo sem√°ntico de los procesos de aceleraci√≥n sociot√©cnica que acostumbra a utilizar el sistema tecnocapitalista para cumplir con su paradigma de crecimiento exponencial. Estas tendencias aceleracionistas que procuran conceder lo deseado en el menor tiempo posible en nombre de la m√°xima eficiencia, nos han conducido a lo que algunos autores han denominado sociedades del sofoco y la fatiga (Espluga, 2021), repercutiendo asimismo en la producci√≥n textual e iconogr√°fica de los √∫ltimos dos a√±os, trav√©s de la implementaci√≥n de la ingenier√≠a de la demanda o prompt engineering.";
                const resumenLines = doc.splitTextToSize(resumen, maxWidth);
                addTextWithPageOverflowHandling(doc, resumenLines, marginLeft, yPos, pageHeight);
                yPos += resumenLines.length * 14 + 20;

                for (let section in paperContent) {
                    if (paperContent[section] && typeof paperContent[section] === "string" && paperContent[section].trim() !== "") {
                        doc.setFont("times", "bold");
                        doc.setFontSize(14);
                        if (yPos > pageHeight) {
                            doc.addPage();
                            yPos = 40;
                        }
                        doc.text(section, marginLeft, yPos);
                        yPos += 20;

                        doc.setFont("times", "normal");
                        doc.setFontSize(11);
                        const sectionText = paperContent[section];
                        const splitText = doc.splitTextToSize(sectionText, maxWidth);
                        yPos = addTextWithPageOverflowHandling(doc, splitText, marginLeft, yPos, pageHeight);

                        yPos += 20; // Space between sections
                    } else {
                        console.warn(`Skipping section '${section}' due to invalid content.`);
                        if (yPos > pageHeight) {
                            doc.addPage();
                            yPos = 40;
                        }
                        doc.setFont("times", "italic");
                        doc.setFontSize(11);
                        doc.text(`[${section} contenido no disponible]`, marginLeft, yPos, { maxWidth: maxWidth, align: "justify" });
                        yPos += 40;
                    }
                }

                doc.save("paper_completo.pdf");
            } catch (error) {
                console
                error("Error generating PDF:", error);
                alert("Hubo un error al generar el PDF. Por favor, revisa el contenido e int√©ntalo de nuevo.");
            }
        }

        // Helper function to add text and handle page overflow
        function addTextWithPageOverflowHandling(doc, textLines, marginLeft, yPos, pageHeight) {
            for (let i = 0; i < textLines.length; i++) {
                if (yPos > pageHeight) {
                    doc.addPage();
                    yPos = 40; // Reset yPos for the new page
                }
                doc.text(textLines[i], marginLeft, yPos);
                yPos += 14; // Approximate line height
            }
            return yPos;
        }
    </script>
</body>
</html>
